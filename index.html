<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>MindReader V18 - Verdict</title>
    <style>
        /* --- 1. è§†è§‰æ ¸å¿ƒ (Cyber-Analyst Style) --- */
        :root {
            --bg: #000000;
            --glass: rgba(20, 20, 20, 0.85);
            --border: rgba(255, 255, 255, 0.15);
            --accent: #00f2ff; /* æ­£å¸¸/åŸºå‡† */
            --warn: #ffcc00;   /* æ€è€ƒ/è¯„ä¼° */
            --danger: #ff2a6d; /* æ’’è°/ç„¦è™‘ */
            --text: #ffffff;
        }

        body {
            background: var(--bg); color: var(--text);
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", monospace;
            margin: 0; height: 100dvh; display: flex; flex-direction: column; overflow: hidden;
        }

        .app { flex: 1; display: flex; flex-direction: column; position: relative; width: 100%; height: 100%; }

        /* --- 2. é¡¶éƒ¨æƒ…æŠ¥æ  --- */
        .hud {
            min-height: 100px; background: var(--glass); border-bottom: 1px solid var(--border);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            padding: 10px 20px; z-index: 50; flex-shrink: 0; position: relative; backdrop-filter: blur(20px);
        }
        .phase-badge {
            font-size: 10px; font-weight: 800; letter-spacing: 2px; padding: 4px 8px;
            border-radius: 4px; margin-bottom: 8px; text-transform: uppercase; border: 1px solid currentColor;
        }
        .q-text { font-size: 16px; font-weight: 600; text-align: center; line-height: 1.4; max-width: 600px; }
        .progress { position: absolute; bottom: 0; left: 0; height: 4px; background: var(--accent); width: 0%; transition: width 0.1s linear; }

        /* --- 3. ç›‘æ§ç”»é¢ --- */
        .viewport {
            flex: 1; position: relative; background: #050505; display: flex; justify-content: center; align-items: center; overflow: hidden;
        }
        #main_canvas {
            width: 100%; height: 100%; object-fit: contain; transform: scaleX(-1);
        }

        /* å®æ—¶å¾®è¡¨æƒ…æµ®å±‚ */
        .detect-tags {
            position: absolute; top: 10px; right: 10px; display: flex; flex-direction: column; gap: 5px; pointer-events: none;
        }
        .tag {
            background: rgba(0,0,0,0.6); padding: 5px 10px; border-radius: 4px; font-size: 10px;
            font-weight: bold; border-left: 3px solid; opacity: 0; transition: opacity 0.2s;
        }
        .tag.active { opacity: 1; }
        .tag.danger { border-color: var(--danger); color: var(--danger); }
        .tag.warn { border-color: var(--warn); color: var(--warn); }
        .tag.info { border-color: var(--accent); color: var(--accent); }

        /* --- 4. åº•éƒ¨ä»ªè¡¨ç›˜ --- */
        .dashboard {
            height: 120px; background: var(--glass); border-top: 1px solid var(--border);
            display: flex; gap: 10px; padding: 15px; flex-shrink: 0; overflow-x: auto;
            backdrop-filter: blur(20px); padding-bottom: calc(15px + env(safe-area-inset-bottom));
        }
        .dash-card {
            flex: 1; min-width: 90px; background: rgba(255,255,255,0.03); border: 1px solid var(--border);
            border-radius: 8px; position: relative; overflow: hidden;
        }
        .dash-label { position: absolute; top: 5px; left: 5px; font-size: 8px; color: #666; font-weight: bold; }
        .mini-canvas { width: 100%; height: 100%; opacity: 0.6; }

        /* --- 5. å¯åŠ¨ & æŠ¥å‘Šå±‚ --- */
        .layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.95); z-index: 100; display: flex; flex-direction: column;
            align-items: center; justify-content: center; transition: opacity 0.3s;
        }
        .layer.hidden { opacity: 0; pointer-events: none; }

        .btn-main {
            margin-top: 30px; padding: 16px 40px; border-radius: 50px; border: none;
            background: linear-gradient(135deg, var(--accent), #0044ff); color: #fff;
            font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 0 20px rgba(0, 242, 255, 0.2);
        }

        /* æŠ¥å‘Šå¸ƒå±€ */
        .report-box { width: 100%; height: 100%; overflow-y: auto; padding: 20px; box-sizing: border-box; }
        .evidence-row { display: flex; gap: 10px; margin-bottom: 30px; }
        .photo-card { flex: 1; background: #111; border: 1px solid #333; border-radius: 8px; overflow: hidden; }
        .photo-img { width: 100%; height: auto; display: block; border-bottom: 1px solid #333; }
        .photo-meta { padding: 8px; font-size: 10px; text-align: center; color: #888; text-transform: uppercase; font-weight: bold; }
       Â 
        .log-item {
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 8px; margin-bottom: 10px;
            border-left: 3px solid #555;
        }
        .log-item.stress { border-left-color: var(--danger); background: rgba(255, 42, 109, 0.05); }
        .log-item.baseline { border-left-color: var(--accent); }

        #src_video { display: none; }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/holistic/holistic.js" crossorigin="anonymous"></script>
</head>
<body>

<div class="layer" id="layer_start">
    <h1 style="letter-spacing: -2px; margin-bottom: 5px;">MIND<span style="color:var(--accent)">READER</span></h1>
    <p style="color:#666; font-size:12px">V18 VERDICT EDITION</p>
    <div style="margin-top:40px; text-align:center; color:#888; font-size:12px; line-height:1.8">
        å·²åŠ è½½é€»è¾‘æ¨¡å—ï¼š<br>
        â€¢ <span style="color:var(--danger)">DECEPTION</span>: æ‘¸é¼»æ£€æµ‹ (Pinocchio)<br>
        â€¢ <span style="color:var(--warn)">EVALUATION</span>: æ‘¸ä¸‹å·´/æ‰‹æŒ‡æ“åŠ¨<br>
        â€¢ <span style="color:var(--accent)">SHOCK</span>: çªçœ¼/æƒŠè®¶æ£€æµ‹<br>
        â€¢ <span style="color:#fff">EVIDENCE</span>: å¼‚å¸¸ç¬é—´è‡ªåŠ¨æŠ“æ‹
    </div>
    <button class="btn-main" onclick="startSystem()">å¯åŠ¨å®¡è®¯æµç¨‹</button>
</div>

<div class="app">
    <div class="hud">
        <div class="phase-badge" id="hud_badge" style="color:var(--accent); border-color:var(--accent)">SYSTEM READY</div>
        <div class="q-text" id="hud_text">ä¼ æ„Ÿå™¨æ ¡å‡†ä¸­...</div>
        <div class="progress" id="hud_bar"></div>
    </div>

    <div class="viewport">
        <div class="detect-tags">
            <div class="tag danger" id="tag_nose">ğŸ¤¥ æ‘¸é¼»(æ©é¥°)</div>
            <div class="tag warn" id="tag_chin">ğŸ¤” æ‘¸ä¸‹å·´(è¯„ä¼°)</div>
            <div class="tag warn" id="tag_fidget">ğŸ¤ æ‰‹æŒ‡æ“åŠ¨(ç„¦è™‘)</div>
            <div class="tag info" id="tag_shock">ğŸ˜² çªçœ¼(æƒŠè®¶)</div>
        </div>
        <canvas id="main_canvas"></canvas>
    </div>

    <div class="dashboard">
        <div class="dash-card"><div class="dash-label">FACE MESH</div><canvas id="cv_face" class="mini-canvas"></canvas></div>
        <div class="dash-card"><div class="dash-label">SKELETON</div><canvas id="cv_pose" class="mini-canvas"></canvas></div>
        <div class="dash-card"><div class="dash-label">HANDS</div><canvas id="cv_hands" class="mini-canvas"></canvas></div>
    </div>
</div>

<div class="layer hidden" id="layer_report">
    <div class="report-box">
        <h2 style="text-align:center; color:var(--accent); margin-bottom:30px">æœ€ç»ˆè£å†³æ¡£æ¡ˆ</h2>
       Â 
        <div style="font-size:12px; color:#888; margin-bottom:10px">EVIDENCE SNAPSHOTS (å…³é”®å¸§æŠ“æ‹)</div>
        <div class="evidence-row" id="evidence_area">
            </div>

        <div style="font-size:12px; color:#888; margin-bottom:10px">BEHAVIOR LOG (è¡Œä¸ºæµæ°´)</div>
        <div id="log_area"></div>

        <button class="btn-main" style="width:100%; background:#333; margin-top:20px" onclick="location.reload()">å½’æ¡£å¹¶é‡ç½®</button>
    </div>
</div>

<video id="src_video" playsinline></video>

<script>
    // --- éšæœºé¢˜åº“ ---
    const POOL_BASE = ["ç®€å•ä»‹ç»ä¸€ä¸‹ä½ æœ€è¿‘åœ¨å¿™ä»€ä¹ˆï¼Ÿ", "ä½ æœ€å–œæ¬¢çš„é£Ÿç‰©æ˜¯ä»€ä¹ˆï¼Ÿæè¿°ä¸€ä¸‹å‘³é“ã€‚"];
    const POOL_STRESS = [
        "ã€é«˜å‹ã€‘çœ‹ç€æˆ‘ã€‚ä½ æ˜¯å¦æ›¾ç»èƒŒå›è¿‡ä¿¡ä»»ä½ çš„äººï¼Ÿ",
        "ã€ä¸¤éš¾ã€‘ä¼´ä¾£å’Œæ¯äº²åŒæ—¶è½æ°´ï¼Œåªèƒ½æ•‘ä¸€ä¸ªï¼Œä½ æ•‘è°ï¼Ÿç«‹åˆ»å›ç­”ï¼",
        "ã€å®¡è®¯ã€‘å¦‚æœç°åœ¨æŸ¥ä½ çš„æ‰‹æœºæµè§ˆè®°å½•ï¼Œä¼šæœ‰è§ä¸å¾—äººçš„ä¸œè¥¿å—ï¼Ÿ"
    ];

    let SCRIPT = [];
    let sessionData = [];
    let currentQ = null;
   Â 
    // æŠ“æ‹åº“
    let evidence = { baseline: null, anomaly: null, maxScore: 0 };

    // ç»Ÿè®¡å˜é‡
    let tempStats = {Â 
        blinks: 0,Â 
        baseEyeHeight: 0, // åŸºå‡†çœ¼ç›å¼€åˆåº¦
        noseTouchCount: 0,
        chinTouchCount: 0,
        fidgetCount: 0,
        shockCount: 0,
        frames: 0
    };

    // --- å¯åŠ¨ ---
    async function startSystem() {
        // éšæœºæŠ½é¢˜: 2åŸºå‡† + 2é«˜å‹
        SCRIPT = [
            { id: 1, type: 'baseline', time: 8, text: POOL_BASE[Math.floor(Math.random()*POOL_BASE.length)] },
            { id: 2, type: 'baseline', time: 8, text: "å¥½çš„ã€‚å¹³æ—¶å‘¨æœ«ä½ ä¸€èˆ¬å‡ ç‚¹èµ·åºŠï¼Ÿ" },
            { id: 3, type: 'stress', time: 10, text: POOL_STRESS[Math.floor(Math.random()*POOL_STRESS.length)] },
            { id: 4, type: 'stress', time: 10, text: "ä½ åœ¨æ’’è°å—ï¼Ÿä¸ºä»€ä¹ˆä½ åˆšæ‰çš„è¡¨æƒ…ä¸å¯¹åŠ²ï¼Ÿ" }
        ];

        document.getElementById('layer_start').classList.add('hidden');
       Â 
        const video = document.getElementById('src_video');
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { width: { ideal: 640 }, height: { ideal: 480 }, facingMode: "user" } });
            video.srcObject = stream;
            await video.play();

            const holistic = new Holistic({locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/holistic/${file}`});
            holistic.setOptions({modelComplexity: 1, minDetectionConfidence: 0.5, refineFaceLandmarks: true});
            holistic.onResults(onResults);
           Â 
            const camera = new Camera(video, {
                onFrame: async () => { await holistic.send({image: video}); },
                width: 640, height: 480
            });
            camera.start();

            setTimeout(() => runQuestion(0), 3000);
        } catch (e) { alert("æ‘„åƒå¤´å¯åŠ¨å¤±è´¥"); }
    }

    // --- æµç¨‹æ§åˆ¶ ---
    function runQuestion(index) {
        if (index >= SCRIPT.length) { generateReport(); return; }

        // å…³é”®é€»è¾‘ï¼šå¦‚æœæ˜¯åŸºå‡†æœŸç»“æŸï¼Œæ‹ä¸€å¼ æ­£å¸¸çš„
        if (index === 2 && !evidence.baseline) captureEvidence('baseline');

        currentQ = SCRIPT[index];
        // é‡ç½®å½“é¢˜ç»Ÿè®¡ï¼Œä¿ç•™åŸºå‡†æ•°æ®
        const oldBase = tempStats.baseEyeHeight;
        tempStats = {Â 
            blinks: 0, noseTouchCount: 0, chinTouchCount: 0, fidgetCount: 0, shockCount: 0,Â 
            frames: 0, lastEyeOpen: true, baseEyeHeight: oldBaseÂ 
        };

        // UI
        const isBase = currentQ.type === 'baseline';
        const badge = document.getElementById('hud_badge');
        badge.innerText = isBase ? `BASELINE #${currentQ.id}` : `STRESS TEST #${currentQ.id}`;
        badge.style.color = isBase ? 'var(--accent)' : 'var(--danger)';
        badge.style.borderColor = isBase ? 'var(--accent)' : 'var(--danger)';
       Â 
        document.getElementById('hud_text').innerText = currentQ.text;
       Â 
        const bar = document.getElementById('hud_bar');
        bar.style.transition = 'none'; bar.style.width = '0%';
        setTimeout(() => { bar.style.transition = `width ${currentQ.time}s linear`; bar.style.width = '100%'; }, 50);

        setTimeout(() => {
            saveData();
            runQuestion(index + 1);
        }, currentQ.time * 1000);
    }

    function captureEvidence(type) {
        const canvas = document.getElementById('main_canvas');
        evidence[type] = canvas.toDataURL('image/jpeg', 0.8);
    }

    function saveData() {
        const cpm = Math.round(tempStats.blinks / (currentQ.time / 60));
        sessionData.push({ q: currentQ, stats: { ...tempStats, blinkRate: cpm } });
    }

    // --- AI æ ¸å¿ƒåˆ†æ (Logic V18) ---
    const canvas = document.getElementById('main_canvas');
    const ctx = canvas.getContext('2d');
    const sideCtx = {
        face: document.getElementById('cv_face').getContext('2d'),
        pose: document.getElementById('cv_pose').getContext('2d'),
        hands: document.getElementById('cv_hands').getContext('2d')
    };

    function onResults(results) {
        // æ¸²æŸ“
        const video = document.getElementById('src_video');
        const vW = video.videoWidth; const vH = video.videoHeight;
        if(vW) {
            canvas.width = vW; canvas.height = vH;
            ctx.save(); ctx.clearRect(0, 0, vW, vH); ctx.drawImage(video, 0, 0, vW, vH);
        } else { ctx.restore(); return; }

        if (!results.faceLandmarks) { ctx.restore(); return; }

        // --- 1. é¢éƒ¨å…³é”®ç‚¹æå– ---
        const face = results.faceLandmarks;
        const noseTip = face[1];      // é¼»å°–
        const chinTip = face[152];    // ä¸‹å·´åº•
        const leftEyeTop = face[159]; const leftEyeBot = face[145];
        const eyeHeight = Math.abs(leftEyeTop.y - leftEyeBot.y);

        // åŸºå‡†æ•°æ®ç§¯ç´¯
        if (currentQ && currentQ.type === 'baseline') {
            tempStats.baseEyeHeight = (tempStats.baseEyeHeight * tempStats.frames + eyeHeight) / (tempStats.frames + 1);
        }

        // ç»˜åˆ¶è¾…åŠ©çº¿ (çœ¼ç›/ä¸‹å·´/é¼»å­)
        drawConnectors(ctx, face, FACEMESH_TESSELATION, {color: '#ffffff11', lineWidth: 0.5});

        // --- 2. é€»è¾‘åˆ¤å®š ---
        let currentAnomalyScore = 0; // å½“å‰å¸§å¼‚å¸¸åˆ†ï¼Œç”¨äºè§¦å‘æŠ“æ‹
        const tags = { nose: false, chin: false, fidget: false, shock: false };

        // A. æƒŠè®¶ (Shock) - çªçœ¼
        // é€»è¾‘ï¼šå¦‚æœå½“å‰çœ¼ç›å¼€åˆåº¦ > åŸºå‡†å€¼çš„ 1.3 å€
        if (currentQ && currentQ.type === 'stress' && tempStats.baseEyeHeight > 0) {
            if (eyeHeight > tempStats.baseEyeHeight * 1.35) {
                tags.shock = true;
                tempStats.shockCount++;
                currentAnomalyScore += 5;
            }
        }

        // B. æ‰‹éƒ¨äº¤äº’ (Hand-Face Interaction)
        const checkHandFace = (hand) => {
            if (!hand) return;
            const indexTip = hand[8]; // é£ŸæŒ‡å°–
            const thumbTip = hand[4]; // æ‹‡æŒ‡å°–

            // B1. æ‘¸é¼»å­ (Lying/Pinocchio)
            // ç®€å•è·ç¦»è®¡ç®—: é£ŸæŒ‡å°– åˆ° é¼»å°–
            const distNose = Math.sqrt(Math.pow(indexTip.x - noseTip.x, 2) + Math.pow(indexTip.y - noseTip.y, 2));
            if (distNose < 0.05) { // é˜ˆå€¼éœ€è°ƒè¯•
                tags.nose = true;
                tempStats.noseTouchCount++;
                currentAnomalyScore += 10;
                // ç”»çº¢åœˆ
                ctx.beginPath(); ctx.arc(noseTip.x * vW, noseTip.y * vH, 20, 0, 2*Math.PI);
                ctx.strokeStyle = 'var(--danger)'; ctx.lineWidth = 3; ctx.stroke();
            }

            // B2. æ‘¸ä¸‹å·´ (Evaluating)
            const distChin = Math.sqrt(Math.pow(indexTip.x - chinTip.x, 2) + Math.pow(indexTip.y - chinTip.y, 2));
            if (distChin < 0.08 && !tags.nose) { // é¿å…è¯¯åˆ¤
                tags.chin = true;
                tempStats.chinTouchCount++;
                currentAnomalyScore += 3;
            }

            // B3. æ‰‹æŒ‡æ“åŠ¨ (Fidgeting)
            // æ‹‡æŒ‡å°– åˆ° é£ŸæŒ‡å°– çš„è·ç¦»
            const distPinch = Math.sqrt(Math.pow(indexTip.x - thumbTip.x, 2) + Math.pow(indexTip.y - thumbTip.y, 2));
            if (distPinch < 0.03) { // æåœ¨ä¸€èµ·
                 tags.fidget = true;
                 tempStats.fidgetCount++;
                 currentAnomalyScore += 2;
            }
        };

        if (results.leftHandLandmarks) checkHandFace(results.leftHandLandmarks);
        if (results.rightHandLandmarks) checkHandFace(results.rightHandLandmarks);

        // --- 3. UI åé¦ˆä¸æŠ“æ‹ ---
        // æ›´æ–°å³ä¸Šè§’æ ‡ç­¾æ˜¾ç¤ºçŠ¶æ€
        document.getElementById('tag_nose').className = `tag danger ${tags.nose ? 'active' : ''}`;
        document.getElementById('tag_chin').className = `tag warn ${tags.chin ? 'active' : ''}`;
        document.getElementById('tag_fidget').className = `tag warn ${tags.fidget ? 'active' : ''}`;
        document.getElementById('tag_shock').className = `tag info ${tags.shock ? 'active' : ''}`;

        // æ™ºèƒ½æŠ“æ‹ï¼šå¦‚æœå¤„äºå‹åŠ›æœŸï¼Œä¸”å½“å‰å¼‚å¸¸åˆ†æé«˜ï¼Œä¸”ä¹‹å‰æ²¡æ‹è¿‡æ›´ç‹ çš„
        if (currentQ && currentQ.type === 'stress' && currentAnomalyScore > evidence.maxScore) {
            evidence.maxScore = currentAnomalyScore;
            captureEvidence('anomaly'); // è¦†ç›–æŠ“æ‹æœ€â€œç²¾å½©â€çš„ä¸€ç¬é—´
        }

        ctx.restore();
       Â 
        // ä¾§è¾¹æ 
        drawSide(sideCtx.face, results.faceLandmarks, FACEMESH_TESSELATION, '#00f2ff');
        drawSide(sideCtx.pose, results.poseLandmarks, POSE_CONNECTIONS, '#fff');
        drawSide(sideCtx.hands, results.leftHandLandmarks || results.rightHandLandmarks, HAND_CONNECTIONS, '#ff2a6d');

        if(currentQ) tempStats.frames++;
    }

    function drawSide(c, data, conn, color) {
        c.canvas.width=150; c.canvas.height=150; c.clearRect(0,0,150,150);
        if(data) { c.save(); drawConnectors(c, data, conn, {color: color, lineWidth: 2}); c.restore(); }
    }

    // --- æŠ¥å‘Šç”Ÿæˆ ---
    function generateReport() {
        document.getElementById('layer_report').classList.remove('hidden');
       Â 
        // 1. è¯æ®å›¾ç‰‡å¡«å……
        const evArea = document.getElementById('evidence_area');
        // é€»è¾‘ä¿®å¤ï¼šå¦‚æœæ²¡æœ‰æŠ“æ‹åˆ°å¼‚å¸¸ï¼Œå°±æ˜¾ç¤ºä¸€å¼ ç©ºç™½å ä½æˆ–æœ€åä¸€å¼ 
        const imgBase = evidence.baseline || "";
        const imgAnom = evidence.anomaly || imgBase; // å¦‚æœæ²¡å¼‚å¸¸ï¼Œå°±ç”¨åŸºå‡†å›¾ä»£æ›¿ï¼Œé¿å…ç©ºç™½
       Â 
        evArea.innerHTML = `
            <div class="photo-card">
                <img src="${imgBase}" class="photo-img">
                <div class="photo-meta" style="color:var(--accent)">åŸºå‡†çŠ¶æ€ (Relaxed)</div>
            </div>
            <div class="photo-card" style="border-color:var(--danger)">
                <img src="${imgAnom}" class="photo-img">
                <div class="photo-meta" style="color:var(--danger)">å‹åŠ›ååº” / å¼‚å¸¸ (Stress)</div>
            </div>
        `;

        // 2. æ—¥å¿—åˆ—è¡¨
        const logArea = document.getElementById('log_area');
        let html = "";
       Â 
        sessionData.forEach(d => {
            const isStress = d.q.type === 'stress';
            let signals = [];
           Â 
            if (d.stats.noseTouchCount > 5) signals.push("é¢‘ç¹æ‘¸é¼» (æ©é¥°)");
            if (d.stats.chinTouchCount > 10) signals.push("æ‘¸ä¸‹å·´ (è¯„ä¼°)");
            if (d.stats.shockCount > 5) signals.push("ç³å­”/çœ¼ç‘å¼‚å¸¸æ‰©å¼  (æƒŠè®¶)");
            if (d.stats.fidgetCount > 20) signals.push("æ‰‹æŒ‡é«˜é¢‘æ“åŠ¨ (ç„¦è™‘)");

            const hasSignal = signals.length > 0;
            const colorClass = isStress && hasSignal ? "val-danger" : "";

            html += `
                <div class="log-item ${d.q.type}">
                    <div style="font-size:10px; color:#666; margin-bottom:5px">${d.q.type.toUpperCase()}</div>
                    <div style="font-weight:bold; margin-bottom:10px">"${d.q.text}"</div>
                    ${hasSignal ? `<div style="color:var(--danger); font-size:12px; font-weight:bold">âš  DETECTED: ${signals.join(", ")}</div>` : '<div style="font-size:12px; color:#666">æœªæ£€æµ‹åˆ°æ˜æ˜¾å¼‚å¸¸</div>'}
                </div>
            `;
        });
        logArea.innerHTML = html;
    }
</script>
</body>
</html>
